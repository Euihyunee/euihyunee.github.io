---
title: "💬 로드 밸런싱과 리버스 프록시에 대해서"
date: 2025-02-26 14:27 +0900
categories: [CS]
tags: [Network, DNS, CDN]
---

## 로드 밸런싱


![load_balancing.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/load_balancing.png?raw=true)

로드 밸런싱(Load Balancing)은 네트워크 트래픽을 여러 서버에 분산시켜 서버의 부하를 균등하게 분배하는 기술입니다. 하나의 서버에 많은 트래픽이 들어온다면 성능 저하 및 서버가 다운될 수 있습니다. 이를 해결하기 위해 여러 서버를 두어 이 서버들에게 트래픽을 할당해주는 것이 로드 밸런서(로드 밸런싱을 위한 장치)의 역활입니다. 

## 로드 밸런싱의 주요 기능

로드 밸런싱은 웹과 애플리케이션에서 성능, 안정성, 가용성을 향상시키는 핵심적인 역활을 합니다. 이는 사용자에게 더 빠르고, 안전한 웹 경험을 제공할 수 있습니다. 기업은 서비스의 신뢰성과 성능을 향상시킬 수 있어 고객 만족도를 높이고 비즈니스 성과를 개선할 수 있습니다.

1. 트래픽 분산: 로드 밸런서는 들어오는 네트워크 트래픽을 여러 서버에 균등하게 분배합니다. 이를 통해 특정 서버에 과부하가 걸리는 것을 방지하고 전체 시스템의 성능을 최적화합니다.
2. 상태 확인(Health Check): 로드 밸런서는 트래픽을 분산하기 전에 서버들의 상태를 주기적으로 확인하여 정상 작동 여부를 판단합니다. 문제가 있는 서버를 감지하고 트래픽을 정상 서버로 보내어 서비스가 끊기지 않게 해줍니다.
3. 세션 관리: 사용자 세션을 유지하여 일관된 경험을 제공합니다. 동일 사용자의 요청을 같은 서버로 보내 서비스의 연속성을 보장합니다.
4. 보안 강화: DDoS 공격 등의 위협으로부터 시스템을 보호하고, 트래픽을 모니터링하여 악성 콘텐츠를 차단합니다. 로드 밸런서에는 SSL 암호화 같은 보안 기능이 포함될 수 있습니다. 이를 통해 네트워크 트래픽을 안전하게 전송할 수 있습니다.


## 로드 밸런서의 종류

로드밸런서는 주로 Layer 4(L4)와 Layer(L7) 두 가지 유형으로 나뉩니다. 각각 전송 계층과 애플리케이션 계층 레벨의 데이터를 처리하는 방식입니다. 이로 인해 L7은 더 많은 정보를 바탕으로 복잡한 로드 밸런싱 결정을 내릴 수 있지만, 처리 속도는 L4에 비해 상대적으로 느릴 수 있습니다.

### L4 로드밸런서

L4 로드밸런서는 OSI 모델의 전송 계층에서 작동하며, 단순하고 빠른 트래픽 분배가 필요할 때 사용합니다.

- IP 주소와 포트 번호를 기반으로 트래픽을 분산합니다.
- TCP 및 UDP 프로토콜을 사용하여 트래픽을 관리합니다.
- 패킷 내용을 검사하지 않아 빠르게 전달할 수 있습니다.
- 간단한 알고리즘(ex: 라운드 로빈)을 사용하여 트래픽을 분산합니다.

### L7 로드밸런서

L7 로드밸런서는 애플리케이션 계층(HTTP/HTTPS)에서 동작하며, 더 복잡하고 지능적인 라우팅과 애플리케이션 레벨의 최적화가 필요할 때 사용합니다.

- 애플리케이션 레벨의 데이터를 기반으로 더 정교한 트래픽 분배가 가능합니다. 
- 애플리케이션 레벨의 공격(ex: XSS, SQL 인젝션)을 탐지하고 방어할 수 있습니다.
- 콘텐츠 기반 라우팅을 통해 서버 리소스를 더 효율적으로 활용할 수 있습니다.
- 다양한 애플리케이션 요구사항에 맞춰 구성할 수 있어 복잡한 환경에서 유용합니다.
- SSL 종료, 콘텐츠 압축, 캐싱 등 다양한 기능을 제공하여 전반적인 성능을 향상시킬 수 있습니다.

| 특징 | L4 로드 밸런서 | L7 로드 밸런서 |
|------|----------------|----------------|
| 작동 계층 | 전송 계층 (Layer 4) | 응용 계층 (Layer 7) |
| 사용 정보 | IP 주소, 포트 번호 | HTTP 헤더, URL, 쿠키, 애플리케이션 데이터 |
| 패킷 검사 | 헤더 정보만 검사 | 전체 패킷 내용 검사 |
| 라우팅 결정 | 단순 (IP/포트 기반) | 복잡 (콘텐츠 기반) |
| 성능 | 빠름 | 상대적으로 느림 |
| SSL 종료 | 불가능 | 가능 |
| 콘텐츠 기반 라우팅 | 불가능 | 가능 |
| 애플리케이션 보안 | 제한적 | 강화된 보안 기능 |
| 세션 지속성 | 제한적 (IP 기반) | 고급 (쿠키/세션 ID 기반) |
| 사용 사례 | 단순한 트래픽 분배, 고성능 필요 시 | 복잡한 웹 애플리케이션, API 게이트웨이 |


## 로드 밸런싱 알고리즘

로드 밸런싱 알고리즘에는 정적과 동적 방식이 있습니다. 동적 로드 밸런싱은 변화하는 환경에 더 잘 대응할 수 있고, 정적 로드 밸런싱은 단순하고 예측 가능하지만, 변화하는 환경에 대한 적응력이 떨어진다는 특징이 있습니다. 아래에서 자세히 다루겠습니다.

### ✅정적 로드 밸런싱

정적 로드 밸런싱은 사전에 정의된 규칙을 가지고 트래픽을 분산하며, 단순하고 예측하기 쉽습니다. 다만 유연성이 부족하여 효율적인 분산이 어려울 수 있으며 급격한 트래픽 변화와 서버 상태 변화에 즉각적으로 대응하기 어렵습니다.

1.  **라운드 로빈(Round Robin):**  
클라이언트의 요청을 여러 대의 서버에 순차적으로 분배하는 방식입니다. 서버들의 성능이 비슷하고 처리 시간이 짧은 경우에 유리합니다.
2. **가중치 기반 라운드 로빈(Weighted Round Robin)**:  
각 서버에 가중치를 부여하여 가중치가 높은 서버에 더 많은 요청을 할당합니다. 서버의 처리 용량이 다를 경우 효과적입니다.
3. **IP 해시(IP Hash):**  
클라이언트의 IP 주소를 해시하여 특정 서버에 지속적으로 요청을 보내는 방식입니다. 세션 유지가 필요한 경우에 유용합니다.

### ✅동적 로드 밸런싱

동적 로드 밸런싱은 실시간으로 서버의 상태와 성능을 모니터링하여 트래픽을 분산하기에 서버 상태에 따라 최적화된 분배가 가능합니다. 그렇기에 서버의 추가 및 제거, 트래픽 변화에 빠르게 대응할 수 있습니다. 또한 과부화 또는 장애 서버를 자동으로 감지하고 트래픽을 재분배할 수 있습니다. 다만 구현과 관리가 더 복잡하며, 추가적인 리소스가 필요하고 실시간 모니터링 때문에 약간의 지연(오버헤드)가 발생할 수 있습니다.

1. **최소 연결 방식(Least Connections)**:  
현재 활성 연결이 가장 적은 서버로 새로운 요청을 보냅니다. 세션이 길어지거나 트래픽이 불규칙할 때 효과적입니다.
2. **가중치 기반 최소 연결 방식(Weighted Least Connections)**:  
최소 연결 방식에 서버별 가중치를 추가한 알고리즘입니다. 서버의 처리 능력과 현재 부하를 모두 고려합니다.
3. **최소 응답 시간 방법(Least Response Time)**:  
서버의 현재 연결 상태와 응답 시간을 모두 고려하여 가장 빠른 응답을 제공할 수 있는 서버로 요청을 전달합니다.

## 트래픽에 따른 데이터베이스 동기화

로드밸런싱은 여러 서버에 트래픽을 분산시키는 기술이며, 분산 서버 시스템입니다. 따라서 데이터 동기화 작업을 하여 데이터 일관성을 유지해야 합니다. 동기화 기술은 트래픽에 따라 달라집니다. 트래픽 규모가 증가함에 따라 더 복잡하고 강력한 동기화 기술이 필요하기에 현재 트래픽 수준과 성장을 고려하여 적절한 동기화 전략을 선택해야 합니다.

1. 소규모 트래픽
    - 공유 데이터베이스: 중앙 집중식 데이터베이스를 사용하여 모든 서버가 동일한 데이터에 접근하는 방식입니다.
    - 파일 동기화 도구: Resilio Sync나 SyncThing과 같은 도구를 사용하며 서버 간 파일 동기화에 적합합니다.
2. 중규모 트래픽
    - 캐싱 솔루션: Redis나 Memcached를 사용하여 데이터 접근 속도를 향상시키고 데이터베이스의 부하를 감소시킵니다.
    - 메시지 큐: RabbitMQ나 Apache Kafka를 사용하여 비동기 데이터를 동기화 시킵니다. 이는 실시간 업데이트에 효과적입니다.
3. 대규모 트래픽
    - 데이터베이스 복제: 마스터-슬레이브 구조의 데이터베이스 복제를 사용하며 읽기 작업 분산 및 고가용성을 확보할 수 있습니다.
    - 변경 데이터 캡쳐(CDC): Debezium과 같은 도구를 사용하여 실시간 데이터 변경을 감지하고 동기화할 수 있습니다.
    - 분산 스토리지 시스템: Google Cloud Storage나 Amazon S3와 같은 클라우드 스토리지를 활용하며 대용량 파일 저장 및 공유에 적합합니다.

## 리버스 프록시 

![reverse_proxy.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/reverse_proxy.png?raw=true)

리버스 프록시는 클라이언트와 서버 사이에 위치하여 클라이언트의 요청을 서버로 전달하고 서버의 응답을 클라이언트에게 전달하는 중개자 역활을 합니다. 이는 로드 밸런싱 기능 외에도 캐싱, SSL 종료, 압축, 보안 등 다양한 기능을 제공합니다. 로드 밸런서는 주로 트래픽 분산에 집중하고, 리버스 프록시는 더 유연하고 다양한 설정이 가능합니다.

리버스 프록시는 웹 서버 앞에 위치하여 클라이언트의 요청을 가로채는 서버입니다. 가로친 요청을 서버로 요청을 보내고 응답을 받아와 다시 클라이언트에게 전달합니다. 이는 클라이언트에게 서버의 IP 주소를 노출시키지 않고, 서버 정보를 은닉하여 부적절한 접근을 제안하는 역활을 할 수 있어 보안을 강화할 수 있습니다. 외에도 다양한 역활을 하며 좀 더 자세히 다뤄보겠습니다.

## 리버스 프록시 주요 기능

1. **로드 밸런싱**:  
리버스 프록시는 들어오는 요청을 여러 백엔드 서버에 분산시켜 각 서버의 부하를 줄이고 서비스의 가용성을 높입니다.
2. **보안 강화**:  
리버스 프록시는 백엔드 서버의 실제 IP 주소와 구조를 숨깁니다. 이로 인해 외부에서 직접 서버에 접근하지 못하도록 하여 웹 서비스의 보안을 강화합니다. 리버스 프록시는 클라이언트의 악성 요청 필터링, 접근 제한 등을 수행하여 서버를 보호하고 DDoS 공격 등으로부터 방어합니다.
3. **캐싱 및 성능 최적화**:  
자주 사용되는 정적 파일들(이미지, CSS, JavaScript 등)을 캐시에 저장하여 빠르게 제공합니다. 이를 통해 서버의 부하를 줄이고 응답 시간을 단축시켜 성능을 향상시킵니다.
4. **SSL/TLS 종료**:  
리버스 프록시에서 SSL/TLS 암호화를 처리함으로써 백엔드 서버의 부하를 줄일 수 있습니다. 특히 전자상거래 사이트와 같은 보안이 중요한 서비스에서 유용합니다.
5. **콘텐츠 압축**:  
리버스 프록시를 사용하여 데이터를 압축함으로써 네트워크 트래픽 사용량을 줄이고 전송 속도를 향상시킬 수 있습니다.

> 이러한 이점들로 인해 리버스 프록시는 보안, 성능, 관리 효율성을 크게 향상시킬 수 있습니다.
{: .prompt-info }

## 로드 밸런싱 vs 리버스 프록시 

| 특성 | 로드 밸런싱 | 리버스 프록시 |
|------|------------|---------------|
| 주요 목적 | 트래픽 분산 및 서버 부하 관리 | 요청 중개, 보안 강화, 성능 최적화 |
| 동작 위치 | 주로 서버 클러스터 내부 | 클라이언트와 서버 사이 |
| 주요 기능 | 여러 서버 간 요청 분배 | 요청 필터링, 캐싱, SSL 종료 |
| 확장성 | 서버 추가로 쉽게 확장 가능 | 단일 서버에서도 유용 |
| 보안 측면 | 간접적인 보안 강화 | 직접적인 보안 강화 |
| 프로토콜 지원 | L4(TCP/UDP) 또는 L7(HTTP) | 주로 L7(HTTP) 레벨 |
| 구현 방식 | 하드웨어 또는 소프트웨어 | 주로 소프트웨어 |

## 마치며

▎요약 정리
- 로드 밸런싱 = 트래픽 분산 + 서버 상태 관리 + 장애 복구
- 리버스 프록시 = 보안 강화 + 성능 최적화 + 중앙 집중식 관리

> 핵심 차이: 로드 밸런서는 부하 분산에 특화, 리버스 프록시는 다기능 게이트웨이 역할
{: .prompt-tip } 

오늘날 디지털 서비스 환경에서 단일 서버 운영은 점점 더 어려워지고 있습니다. 이는 사용자 트래픽 폭증, 데이터 처리 요구 증가, 보안 위협 복잡성 등이 복합적으로 작용하기 때문입니다. 초기 비용 절감을 위해 단일 서버를 선책할 경우, 추후 마이그레이션 비용이 초기 설계 비용의 5배 이상 발생하는 사례가 68%에 달한다고 합니다. 

서비스 장애로 인한 브랜드 이미지 손실 등의 문제를 막기 위해서 로드 밸런싱, Kubernetes 클러스터, 서버리스 아키텍처, CDN 연동 등의 아키텍처에 대한 개념 이해는 필수적이라고 생각합니다.

