---
title: "📋 데이터 정합성을 유지하는 방법"
date: 2025-02-12 09:10 +0900
categories: [Database]
tags: [Data, Consistency, ACID, Transaction, Validation]
---

> 데이터 정합성은 여러 시스템이나 데이터베이스 간의 데이터가 일관성을 유지하는 상태를 의미합니다. 이는 데이터가 서로 모순이 없고, 논리적 구조가 일치하여 데이터를 사용하는 데 신뢰성을 유지합니다. 쉽게 말해 "데이터가 서로 맞아떨어지는 것"이라고 할 수 있습니다. 올바른 데이터를 가지고 혼란이 생기지 않으며 정확한 결정을 내릴 수 있습니다. 이 글에서는 이러한 데이터 정합성을 유지하는 방법에 대해 알아보겠습니다.

## 데이터 정합성을 유지하는 구간

데이터 정합성을 유지하는 것은 비즈니스 운영에 매우 중요합니다. 예를 들어, 온라인 쇼핑 사이트의 재고 관리 시스템에서 상품의 재고 수량은 판매 내역과 실시간으로 일치해야 하며, 이를 통해 재고 부족으로 인한 문제를 방지하고 고객에게 정확한 재고 정보를 제공할 수 있습니다.

데이터 일관성은 다음과 같은 구간에서 이루어집니다.

![consistency_web.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/consistency_web.png?raw=true)

1. 데이터 입력 구간(Input)
    - 역활: 사용자가 데이터를 입력하거나 시스템이 데이터를 수집합니다.
    - 입력된 데이터를 기본적으로 검증(ex: 필수 필드 확인, 형식 검사)하여 잘못된 데이터가 서버에 들어오지 않도록 방지합니다.
    - ex: 이메일 형식 확인, 숫자 필드에 문자 입력 방지
2. 유효성 검사(Validation)
    - 역활: 입력된 데이터를 서버에서 추가로 검증합니다.
    - 비즈니스 규칙에 따라 데이터의 유효성을 검사합니다.  
    API 호출 간 일관성을 유지하기 위해 필요한 데이터를 교차 검증합니다.
    - ex: 두 개의 다른 API에서 동일한 사용자 ID를 참조하는 경우 검증 
3. 데이터 처리(Processing)
    - 역활: 데이터를 가공하거나 비즈니스 로직을 적용합니다.
    - 중복 데이터를 제거하거나 병합하여 데이터의 불필요한 반복을 방지합니다.
    - ex: 동일한 이메일 주소가 여러 번 저장되지 않도록 처리
4. 데이터 저장(Storage)
    - 역활: 데이터를 데이터베이스에 저장합니다.
    - 트랜잭션 관리(ACID 속성)를 통해 데이터베이스 내에서 일관성을 보장합니다.
    - 참조 무결성을 유지하여 관계형 데이터베이스에서 테이블 간의 연결이 깨지지 않도록 합니다.
    - ex: 외래 키 제약 조건 설정 
5. 데이터 접근 및 활용(Aceess & Usage)
    - 역활: 사용자가 데이터를 조회하거나 시스템이 데이터를 활용합니다.
    - 캐시와 원본 데이터 간의 일관성을 보장하기 위해 TTL(Time-to-live)을 설정하거나 캐시 무효화 전략을 사용합니다.
    - ex: 사용자 프로필 변경 후 캐시를 즉시 갱신

기본적으로 웹에서는 위와 같은 구간에서 데이터 정합성을 유지할 수 있습니다. 만일 분산 시스템이라면 데이터를 동기화하기 위해서 동기화 프로토콜과 충돌 해결 전략 등을 통해 데이터의 정합성을 유지할 수 있습니다.

이렇게 데이터 정합성을 유지하려면 각 구간에서 적절한 검증과 처리가 필요합니다. 특히 유효성 검사, 트랜잭션 관리, 분산 시스템에서의 동기화는 핵심적인 역활을 하며, 이를 통해 데이터 간 모순 제거, 중복 최소화, 구조적 일관성을 보장할 수 있습니다.

> 백엔드에서 분산 시스템의 일관성을 위해 비즈니스 로직 단계에서 Saga 패턴을 사용한 분산 트랜잭션 관리와 Kafka 같은 메시지 큐를 통해 이벤트 기반 동기화 방법도 있습니다.

## 데이터 정합성은 언제 적용해야 하나?

물론, 모든 데이터의 정합성을 유지하면 정말 좋습니다. 하지만 데이터 정합성을 유지하기 위해서는 비용이 들기 때문에 비용을 최적화하기 위한 전략이 필요합니다.

적용하는 방법으로 데이터의 우선순위를 보는 것입니다. 은행의 재무 데이터같은 경우 강력한 일관성이 필요로 합니다. 이렇게 데이터 정합성을 유지할 데이터를 분석하여 그에 맞게 적용하는 것이 중요합니다. 반대로 고객의 활동 로그, 알림 내역 등은 중요도가 재무 데이터에 비해 떨어집니다. 이런 경우 재무 데이터(계좌/이체 등)는 ACID 트랜잭션으로 처리할 수 있으며, 로그 데이터는 Kafka와 같은 비동기 처리로 해결할 수 있습니다. 이를 통해 **성능과 비용의 균형**을 맞출 수 있습니다.

## 마치며 

데이터 정합성을 유지하는 것은 신뢰할 수 있는 데이터 관리와 효과적인 의사결정을 위해 매우 중요합니다. 이 글에서는 데이터 정합성의 개념과 그것을 유지하기 위한 다양한 방법들을 살펴보았습니다.

데이터 정합성은 데이터 입력부터 저장, 접근 및 활용에 이르기까지 전체 데이터 라이프사이클에 걸쳐 유지되어야 합니다. 각 단계에서 적절한 검증과 처리 과정을 거쳐야 하며, 특히 유효성 검사, 트랜잭션 관리, 그리고 분산 시스템에서의 동기화가 핵심적인 역할을 합니다. 그러나 모든 데이터에 대해 동일한 수준의 정합성을 유지하는 것은 비용 측면에서 비효율적일 수 있습니다. 따라서 데이터의 중요도와 비즈니스 요구사항에 따라 적절한 정합성 수준을 선택하는 것이 중요합니다. 예를 들어, 금융 거래 데이터와 같이 중요한 데이터는 강력한 일관성을 유지해야 하지만, 로그 데이터와 같은 덜 중요한 데이터는 약간의 불일치를 허용할 수 있습니다. 또한, 분산 시스템에서는 Saga 패턴이나 이벤트 기반 동기화와 같은 고급 기술을 사용하여 데이터 정합성을 유지할 수 있습니다. 이러한 방법들은 시스템의 복잡성을 증가시킬 수 있지만, 대규모 분산 환경에서 데이터 정합성을 효과적으로 관리할 수 있게 해줍니다.

결론적으로, 데이터 정합성 유지는 단순히 기술적인 문제가 아니라 비즈니스 요구사항, 시스템 아키텍처, 그리고 비용-효율성을 모두 고려해야 하는 복잡한 과제입니다. 따라서 각 조직의 특성과 요구사항에 맞는 최적의 전략을 수립하고 지속적으로 개선해 나가는 것이 중요합니다.