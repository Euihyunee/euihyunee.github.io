---
title: "💬힙과 스택의 차이에 대해서"
date: 2025-01-31 10:11 +0900
categories: [CS]
tags: [heap, stack, memory, dynamic, static]
---

> 머리말 

## 코드의 실행 과정 

![java_operation_process.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/java_operation_process.png?raw=true)

자바에서는 코드의 실행 과정이 다음과 같습니다. 

1. 개발자가 작성한 `.java` 파일을 IDE에서 실행하면 바로 실행되는 것이 아니라 Java 컴파일러(javac)가 `.java` 소스 코드 파일을 컴파일하여 `.class` 형태의 컴퓨터가 읽을 수 있는 `바이트 코드`로 변환합니다.
2. `바이트 코드`는 모든 Java 가상 머신(`JVM`)에서 실행할 수 있습니다. 
3. JVM을 통해 `.class` 파일이 해석되고 실행됩니다. 

IDE에서 우리가 `.java` 파일을 실행하면 바로 실행되는 것이 아닌 위와 같은 과정을 거칩니다. 여기서 중요한 점은 **컴파일 시점과 마지막 실행 시점**입니다. 

컴파일 시점에서 `스택(Stack)` 영역에 대한 레이아웃. 즉, 스택의 청사진이 만들어지고, 실행 시점에서 `힙(Heap)` 영역을 담당한다고 생각하시면 됩니다. 아래에서 더 자세히 설명하겠습니다.

## 스택(Stack) 메모리란?

스택 메모리는 개발자의 코드를 컴파일하는 과정에서 각 메서드와 지역 변수, 매개변수 정보, 타입, 참조 변수 등을 포함하는 영역입니다. 컴파일 과정에서 개발자가 작성한 코드를 기반으로 스택 메모리 사용에 대한 결정이 이루어집니다. 컴파일러는 이러한 스택 영역의 정보들을 바이트코드에 포함시킵니다.

### 스택의 메모리 할당 시점

![stack_memory_assignment.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/stack_memory_assignment.png?raw=true)

스택은 컴파일된 시점에서 메모리 할당이 이루어지지 않습니다. 컴파일이 완료되었을 때 스택이 어떻게 생겼는지 파악하는 과정입니다. 이를 보고 스택에 얼마나 메모리 공간을 할당할 지 결정합니다. 프로그램 로드 시 OS는 프로그램에 메모리를 할당하고, 이때 메모리의 상위 주소에 스택 세그먼트가 위치합니다. 

프로그램이 실행된 런타임에서 실제 스택 메모리가 할당됩니다. <span style ="color:red">이때 일반적으로 고정된 크기의 메모리가 스택에 할당됩니다.</span> 즉, 동적이 아닌 정적 메모리가 할당됩니다. 

스택의 메모리에는 여유 공간이 있습니다. 덕분에 함수를 실행하거나 새로운 지역 변수가 선언될 때마다 스택에 메모리가 추가로 할당되고, 사용이 끝난 이후에 스택 메모리가 자동으로 반환됩니다. 이 부분이 스택 메모리 내부에서 동적으로 사용되는 부분입니다.

정리하자면, 스택 메모리는 전체적으로는 고정된 메모리를 할당받기 때문에 정적이지만 내부에서는 여유 공간에 의해 동적으로 보이는 구조입니다. 

|관점|크기|
|:--|:--|
|메모리 할당 관점|정적|
|사용 방식 관점|동적|

### 스택 메모리의 특징 

1. **고정된 크기**: 스택 메모리의 전체 크기는 프로그램 시작 시 고정됩니다.
2. **미리 할당**: 운영 체제가 프로세스에 메모리를 할당할 때 스택 영역이 미리 결정됩니다. 
3. **자동 할당/해제**: 함수 호출과 반환에 따라 스택 메모리가 자동으로 할당되고 해제됩니다.
4. **LIFO구조**: 마지막에 추가된 데이터가 먼저 제거되는 구조로 동적인 메모리 관리가 이루어집니다.

## 힙(Heap) 메모리란?

힙(Heap) 메모리는 프로그램 실행 중에 동적으로 할당되고 관리되는 메모리 영역입니다. 객체 인스턴스나 `ArrayList`와 같은 동적 배열 등이 힙 메모리에 해당합니다. 

### 힙의 메모리 할당 시점

힙 메모리는 컴파일 과정에서 크기가 결정되는 스택 메모리와 반대로 프로그램 실행(런타임)에 메모리가 할당됩니다. 

힙 메모리는 프로그램 실행 중 필요한 시점에 언제든지 할당할 수 있기 때문에 유연함을 가집니다. 예를 들어 사용자 입력에 따라 크기가 달라지는 배열을 생성할 때 힙 메모리를 사용하면 제한 없이 사용하는 것이 가능합니다. **즉, 프로그램 실행 중에 메모리 크기를 결정하는 것이 가능합니다.**

### 힙 메모리의 특징

동적으로 할당되는 힙 메모리의 특징은 다음과 같습니다. 

1. **동적 할당**: 힙 메모리는 필요한 만큼 동적으로 할당되고 해제될 수 있습니다. 이는 프로그램에서 사용되는 데이터의 크기를 미리 예측하기 어려울 때 유용합니다.
2. **유연한 크기**: 프로그램 실행 중에 늘어나거나 줄어들 수 있기 때문에 크기가 가변적인 데이터 구조를 다루거나 대용량 데이터 처리를 다루는 데 적합합니다.
3. **명시적 관리**: 힙 메모리는 프로그래머가 직접 관리해야 합니다. 메모리 할당 함수(ex: new)를 사용하여 메모리를 할당하고, 사용이 끝나면 명시적으로 해제해야 합니다.

> 자바에서는 가비지 컬렉션(Garbage Collection, GC)를 통해 더 이상 사용되지 않는 객체들을 자동으로 식별하고 제거하는 프로세스입니다. JVM에서 주기적으로 더 이상 사용되지 않는 객체를 식별하고 제거해주지만 만능은 아닙니다. 메모리 누수같은 사항에 개발자들은 주의해야 합니다.

## 스택과 힙의 차이점!

|구분|스택(Stack)|힙(Heap)|
|:--|:--|:--|
|메모리 할당 시점|컴파일 타임|런타임|
|메모리 크기|고정된 크기|동적으로 변경 가능|
|메모리 관리|자동 관리|수동 관리(프로그래머 책임)|
|데이터 구조|선형 구조(LIFO)|계층적 구조|
|저장되는 데이터|지역 변수, 함수 호출 정보|동적 할당 데이터, 전역 변수|
|메모리 할당 속도|매우 빠름|상대적으로 느림|
|메모리 접근 속도|빠름|느림|
|메모리 해제|자동|수동(free(), delete)|
|생명 주기|함수 호출 동안|프로그래머가 결정|
|사용 예시|지역 벼수, 매개 변수|동적 객체, 대용량 데이터|

## 마치며 

이상으로 스택 메모리와 힙 메모리의 차이점에 대해 알아보았습니다. 스택과 힙 메모리를 이해할 때 '동적'과 '정적'이라는 개념을 혼동하지 않는 것이 중요합니다. 스택 메모리는 전체 크기가 고정되어 있어 정적으로 보이지만, 내부적으로는 함수 호출과 반환에 따라 동적으로 사용됩니다. 반변 힙 메모리는 전체적으로 동적이며, 프로그램 실행 중 필요에 따라 크기가 변경될 수 있습니다. 

이러한 차이점을 이해하는 것은 효율적인 메모리 관리와 최적화된 프로그램 설계에 매우 중요합니다. 스택 메모리의 빠른 할당과 반환 특성을 활용하여 작고 일시적인 데이터를 처리하고, 힙 메모리의 유연성을 이용하여 크기가 가변적이거나 수명이 긴 데이터를 다루는 등 각 메모리 영역의 장점을 적절히 활용할 수 있습니다. 

또한, 메모리 누수나 스택 오버플로우와 같은 문제를 예방하기 위해서는 각 메모리 영역의 특성과 제한사항을 잘 이해하고 있어야 합니다. 특히 힙 메모리 사용 시 적절한 메모리 해제와 관리가 필요하며, 스택 메모리 사용 시 재귀 호출의 깊이나 대용량 지역 변수 선언에 주의해야 합니다. 

결론적으로, 스택과 힙 메모리의 차이점을 정확히 이해하고 적절히 활용하는 것은 효율적이고 안정적인 프로그램 개발의 기초가 됩니다. 이를 통해 더 나은 성능과 안정성을 갖춘 소프트웨어를 설계하고 구현할 수 있습니다.