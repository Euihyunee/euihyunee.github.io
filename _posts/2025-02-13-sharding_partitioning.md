---
title: "📋 샤딩과 파티셔닝"
date: 2025-02-13 09:04 +0900
categories: [Database]
tags: [Database, Sharding, Partitioning]
---

> 데이터베이스에서 대규모 데이터 처리 시 발생하는 성능 저하, 확장성 한계, 관리 복잡성 문제를 해결하기 위해 샤딩과 파티셔닝이 나왔습니다. 데이터가 커질수록 읽기/쓰기 성능은 감소하고, 병목 현상이 일어나게 됩니다. 샤딩과 파티셔닝은 이러한 문제를 해결하기 위한 기술입니다. 이 글에서는 샤딩과 파티셔닝의 개념과 차이점 등에 대해 알아보겠습니다.


## 샤딩이란?

샤딩은 대규모 데이터베이스를 <span style="color:red">***수평적으로 분할***</span>하여 성능과 확장성을 개선하는 기술입니다. 데이터를 작은 단위인 `샤드(Shard)`로 나누어 여러 서버에 분산 저장 및 처리함으로써 시스템 부하를 분산시키는 데이터베이스 설계 기술입니다.

![sharding.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/sharding.png?raw=true)

샤딩은 데이터베이스의 수평 분할에 사용됩니다. 샤드는 함께 단일 논리적 데이터베이스를 형성하지만 각각은 별도의 데이터베이스로 작동합니다. 고객ID나 위치 영역을 표시하는 키에 따라 데이터를 할당하여 각 데이터베이스의 부담을 줄일 수 있습니다.

샤딩의 한 예시는 사용자 ID 범위에 따라 1샤드: 1~100,000, 2샤드: 100,001~200,000 이런식으로 각각의 샤드에 저장할 수 있습니다. 

> 사용자에 따라 요청을 효율적으로 분산할 수 있으므로 사용자가 많아지더라도 시스템을 확장할 수 있습니다.
{: .prompt-info }

### 샤딩의 특징 

1. ***수평 분할***:  
- 데이터를 행(row) 단위로 분할하여 각 샤드가 전체 데이터의 일부를 저장합니다. 
- ex) 사용자 ID 범위별로 다른 샤드에 할당
2. ***샤드 키(Sharding Key)***:  
- 데이터 분배 기준이 되는 속성(사용자 ID, 위치 등)으로 해시 또는 범위 기반 매핑을 통해 샤드를 결정합니다.  
- 적절한 키 선택은 데이터 균형과 쿼리 효율성에 직접적인 영향을 미칩니다.
3. ***독립적 운영***:  
- 각 샤드는 별도의 데이터베이스 인스턴스로 운영되며, 특정 샤드의 장애가 전체 시스템으로 확산되지 않도록 합니다.

|유형|설명|적용 사례|
|:--|:--|:--|
|수평 샤딩|데이터를 행 단위로 분할|MongoDB, MySQL|
|수직 샤딩|컬럼 단위로 분할하여 데이터 유형별 저장|관계형 DB의 테이블 분리|
|디렉터리 기반|외부 조회 서비스가 샤드 위치를 관라|복잡한 분할 기준이 필요한 경우|


### 샤딩의 장단점

#### ✅장점

이렇듯 샤딩은 데이터가 증가해도 샤드를 추가하여 대응이 가능하여 확장성에 유리합니다. 또한 작은 데이터 단위로 이루어지기 때문에 빠른 쿼리 처리가 가능합니다. 마지막으로 샤딩은 별로의 데이터베이스 인스턴스로 운영되기 때문에 특정 샤드의 문제가 전체 시스템에 미치는 영향을 최소화할 수 있습니다.

#### ‼️장점

반대로, 샤드 간 조인 연산이 어려워, 쿼리 로직이 복잡할 수 있습니다. 또한 샤드 키 선택에 따라 특정 샤드에 부하가 집중될 수 있어 데이터 불균형이 일어날 수 있습니다. 
마지막으로 각 샤드는 분리되어 있어 자체 데이터만 처리하므로 데이터가 손실되거나 특정 샤드를 공격 당하면 해당 사용자들의 서비스가 중단될 수 있습니다.

### 샤딩 적용 방법

샤딩을 적용하는 방법에는 여러 가지가 있으며 적용할 때는 데이터 분포, 쿼리 패턴, 확장성, 데이터 정합성, 인덱스 관리 등을 종합적으로 고려하여 최적의 방식을 선택해야 합니다.


#### 1. 범위 기반 샤딩(Range-based Sharding)

- 특정 범위의 데이터를 각 샤드에 할당합니다.
- ex) 사용자 ID 1-10000은 샤드 1, 10001-20000은 샤드 2에 저장 

#### 2. 해시 기반 샤딩(Hash-based Sharding)

- 샤드 키를 해시 함수에 입력하여 결과값에 따라 데이터를 분산합니다.
- 데이터를 균등하게 분배하는 데 효과적 

#### 3. 지역성 기반 샤딩(Location-based Sharding)

- 지리적으로 가까운 데이터를 동일한 샤드에 저장합니다.
- 대규모 지리 데이터를 처리하는 데 적합


## 파티셔닝이란?

파티셔닝(Partitioning)은 대용량 테이블을 물리적으로 작은 단위(파티션)로 분할하여 관리하는 기법으로, 성능 향상과 관리 효율성을 목적으로 합니다. 파티셔닝은 데이터를 작고 관리하기 쉬운 단위로 분할함으로써 병렬 처리를 지원함으로써 쿼리 성능을 개선하고, 데이터의 가용성을 증가시킬 수 있는 데이터베이스 설계 기술입니다.

![partitioning.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/partitioning.png?raw=true)

파티셔닝은 데이터베이스의 수직 분할에 사용됩니다. 일반적으로 파티셔닝은 단일 데이터베이스 서버 내에서 이루어지며, 데이터를 논리적으로 분할하여 관리하는 방법입니다. 하나의 큰 테이블이나 인덱스를 여러 개의 작은 논리적 파티션으로 분할하여 관리합니다.

예시로 온라인 주문 서비스에서 주문 테이블을 주문 날짜를 기준으로 파티셔닝할 수 있습니다.

|Partition|기간|
|:--|:--|
|1|2023.01~2023.03|
|2|2023.04~2023.06|
|3|2023.07~2023.09|
|4|2023.010~2023.12|

> 이렇게 하면 특정 기간의 주문 데이터를 빠르게 조회할 수 있습니다.
{: .prompt-info }

### 파티셔닝의 특징

파티셔닝은 큰 테이블이나 인덱스를 더 작고 관리하기 쉬운 단위인 '파티션'으로 물리적으로 분할하는 것을 의미합니다. 이는 논리적인 데이터 요소들을 여러 개의 엔티티로 나누는 과정입니다.

- 데이터를 논리적 또는 물리적으로 분할
- 각 파티션은 독립적으로 관리 가능
- 전체 데이터는 여전히 하나의 논리적 단위로 취급됨 

### 파티셔닝의 장단점

#### ✅장점

파티션은 필요한 데이터가 있는 단위로 묶기 때문에 해당 파티션만 검색하여 처리 속도가 향상됩니다. 또한, I/O를 분산시켜 UPDATE 성능을 향상시킬 수 있습니다. 그리고 파티션을 분할함에 따라 인덱스 크기 또한 작아지므로 메모리 사용 효율이 증가됩니다.

백업, 복구, 인덱스 생성 등을 파티션 단위로 수행이 가능하기 때문에 개별적인 관리가 가능합니다. 또한 기간별로 분할할 수 있으므로 오래된 데이터를 쉽게 아카이브하거나 삭제하는 것이 용이합니다.

파티션은 데이터를 여러 개의 독립된 물리적 저장 단위로 나누기 때문에 하나의 테이블에 모든 데이터가 있을 때보다 전체 데이터가 한 번에 손상될 가능성이 줄어듭니다. 또한, 일부 파티션에 문제가 발생해도 다른 파티션은 정상적으로 작동하기 때문에 부분적 장애에 대응할 수 있습니다.

#### ‼️단점

먼저, 복잡성이 증가합니다. 데이터의 특성과 쿼리 패턴을 고려해서 적절한 파티션 키를 선택하는 것이 복잡해집니다. 잘못된 파티션 키 선택은 데이터 분포의 불균형을 초래합니다. 또한, 파티션 수가 너무 많아지면 관리가 복잡해지며, 반대로 너무 적으면 파티셔닝의 이점을 활용하기 어렵습니다. 

파티션의 조인 연산은 여러 파티션에 분산된 데이터를 조인하기 때문에 성능 저하가 발생할 수 있으며, 쿼리 실행 시간을 늘릴 수 있습니다. 또한 분산 환경에서는 조인 연산의 관리가 더욱 복잡해지며, 데이터의 일관성을 유지하면서 효율적인 조인을 수행하는 것이 어렵습니다.

마지막으로 제한사항이 있습니다. 테이블과 인덱스를 분리할 수 없어 함께 파티셔닝 해야합니다. 또한 DBMS별로 지원하는 파티셔닝 기능과 구문에서 차이가 있을 수 있습니다.

### 파티셔닝 적용 방법

#### 1. 범위 파티셔닝(Range Partitioning)

- 특정 컬럼의 값 범위를 기준으로 데이터를 분할합니다.

ex)예시로
- 날짜 기준: 월별 또는 연도별로 데이터 분할
- 숫자 범위: 고객 ID 1-10000, 10001-20000 등으로 분할

#### 2. 리스트 파티셔닝(List Partitioning)

- 특정 컬럼의 값 목록을 기준으로 데이터를 분류합니다.

ex)예시로
- 지역별: 아시아, 유럽, 북미 등으로 분할 
- 카테고리별: 제품 유형에 따라 분할 

#### 3. 해시 파티셔닝(Hash Partitioning)

- 해시 함수를 사용하여 데이터를 균등하게 분산시킵니다.
- 데이터를 고르게 분해하는 데 효과적

#### 4. 복합 파티셔닝(Composite Partitioning)

- 여러 파티셔닝 방식을 조합하여 사용합니다. 
- 예시로, 먼저 범위 파티셔닝을 적용한 후 해시 파티셔닝을 적용할 수 있습니다.

## 샤딩 vs 파티셔닝

정리해보자면 샤딩과 파티셔닝의 차이점은 다음 표로 정리해봤습니다.

|주요 특징|샤딩(Sharding)|파티셔닝(Partitioning)|
|:--|:--|:--|
|규모|주로 여러 서버에 걸쳐 수평적 확장을 위해 사용됨|단일 데이터베이스 서버 내에서 데이터 관리 및 최적화를 위해 사용됨|
|데이터 분산|각 샤드는 고유한 데이터 부분집합을 보유. 샤드 간 중복 없음|파티션은 하나의 데이터 베이스 인스턴스 내에 있을 수 있으며 논리적으로 중복될 수 있음|
|유지보수 복잡성|여러 서버를 관리해야 하므로 유지보수가 복잡함|일반적으로 단일 서버 내에서 이루어지므로 유지보수가 더 간단함|
|성능 영향|데이터를 분산시켜 부하를 줄이고 서버 간 성능을 향상시킴|단일 서버 내에서 쿼리 성능을 최적화함|
|사용 사례|높은 확장성이 필요한 대규모 데이터셋에 이상적|로컬 또는 단일 서버 데이터베이스의 성능 최적화에 적합|
|장애 격리|한 샤드의 장애가 격리되어 다른 샤드에 미치는 영향 최소화|한 파티션의 장애가 전체 데이터베이스 서버에 영향을 미칠 수 있음|
|데이터 모델|샤드 키와 데이터 분산을 위한 데이터 모델 조정 필요|파티셔닝 키 설계가 필요하지만 더 간단한 단일 인스턴스 설정 내에서 이루어짐|

## 마치며 

샤딩과 파티셔닝은 대규모 데이터베이스 시스템에서 성능과 확장성을 향상시키기 위한 중요한 기술입니다. 이 글에서는 두 기술의 개념, 특징, 장단점, 그리고 적용 방법에 대해 살펴보았습니다.

샤딩은 데이터를 여러 서버에 분산시켜 수평적 확장성을 제공하는 반면, 파티셔닝은 주로 단일 데이터베이스 서버 내에서 데이터를 논리적으로 분할하여 관리 효율성을 높입니다. 두 기술 모두 대용량 데이터 처리 시 발생하는 성능 저하와 관리 복잡성 문제를 해결하는 데 도움이 됩니다.

샤딩은 여러 서버에 걸쳐 데이터를 분산시키므로 높은 확장성을 제공하지만, 관리 복잡성이 증가합니다. 반면 파티셔닝은 단일 서버 내에서 이루어져 관리가 비교적 간단하지만, 확장성 면에서는 제한적일 수 있습니다.

적절한 기술 선택은 시스템의 요구사항, 데이터 특성, 그리고 예상되는 성장 패턴에 따라 달라집니다. 때로는 두 기술을 함께 사용하여 시너지 효과를 얻을 수도 있습니다.
마지막으로, 이 글에서는 각 기술의 장단점과 적용 방법에 대해 간략히 다루었지만, 실제 구현 시에는 더 깊이 있는 기술적 고려사항과 최적화 전략이 필요할 것입니다. 또한, 특정 데이터베이스 시스템에 따라 지원되는 기능과 구현 방식이 다를 수 있으므로, 사용 중인 데이터베이스 시스템의 문서를 참조하는 것이 중요합니다.