---
title: "📋 분산 데이터베이스 시스템과 CAP이론의 적용 사례"
date: 2025-02-13 12:04 +0900
categories: [Database]
tags: [Distributed Database, CAP, Consistency, Availability, Partition Tolerance]
---

![distributed_cap.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/distributed_cap.png?raw=true)

> 분산 데이터베이스는 현대의 대규모 데이터 처리와 고가용성 요구사항을 충족시키기 위해 사용됩니다. 이러한 시스템의 설계와 운영에 있어 CAP 이론은 중요한 지침을 제공합니다. 이 글에서 분산 데이터베이스와 CAP 이론에 대해 알아보겠습니다.

## 분산 데이터베이스 시스템이란?

분산 데이터베이스 시스템은 논리적으로는 하나의 통합된 데이터베이스로 작동하지만, 물리적으로는 네트워크를 통해 연결된 여러 컴퓨터나 사이트에 분산되어 있는 데이터베이스 시스템을 말합니다.

이는 여러 지점을 가진 대형 도서관 체인과 비슷합니다.

![ex_distributed.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/ex_distributed.png?raw=true)

💡물리적 분산의 예로 여러 도시에 도서관 지점들이 있고, 각 지점들은 자체적으로 책들을 보관하고 있습니다.

💡논리적 통합의 예로 이용자는 어느 지점에서든 전체 도서관의 모든 책을 검색하고 이용할 수 있습니다. 마치 하나의 큰 도서관을 이용하는 것처럼 느낍니다. 

***✅실제 시스템에서의 의미***

- **물리적 분산**: 데이터는 실제로 여러 컴퓨터나 서버에 나누어 저장됩니다. 이 컴퓨터들은 서로 다른 장소에 있을 수 있습니다.
- **논리적 통합**: 사용자 입장에서는 마치 하나의 큰 데이터베이스를 사용하는 것처럼 느낍니다. 데이터가 어디에 저장되어 있는지 신경 쓸 필요가 없습니다.
- **네트워크 연결**: 이 모든 컴퓨터들은 인터넷이나 다른 네트워크로 연결되어 있어, 필요할 때 서로 통신하고 데이터를 주고받을 수 있습니다.

> 이러한 구조는 대규모 데이터를 효율적으로 관리하고, 시스템의 성능과 안정성을 높이는 데 도움이 됩니다.
{: .prompt-info }

### 주요 특징

1. **물리적 분산, 논리적 통합**: 데이터는 여러 위치에 물리적으로 분산되어 있지만, 사용자에게는 하나의 통합된 시스템으로 보입니다.
2. **투명성**: 사용자는 데이터의 물리적 위치나 분산 구조를 알 필요 없이 데이터에 접근할 수 있습니다. 
3. **자원 분산**: 데이터베이스 리소스가 여러 노드에 분산되어 있습니다.
4. **네트워크 통신**: 분산된 구성 요소들은 네트워크를 통해 메시지를 교환합니다.
5. **지역 자치성**: 각 사이트는 어느 정도의 자율성을 가지고 운영됩니다.

### 구성 요소 

분산 데이터베이스 시스템은 기본적으로 각 지점의 도서관 역활을 하는 노드, 모든 도서관을 통합해주는 메인 데이터베이스, 노드와 데이터베이스를 연결하기 위한 네트워크로 이루어져 있습니다. 

1. 분산 처리기(with Node)
    - 각 노드에서 데이터를 처리하는 역활을 담당합니다. 
    - 노드와 연결되어 사용자의 요청을 처리하고, 필요한 경우 다른 노드와 협력하여 데이터를 처리합니다.
    - 메인 데이터베이스와도 연결되어 전체 시스템의 논리적 일관성을 유지합니다.
2. 분산 데이터베이스
    - 각 노드에 저장된 데이터베이스를 의미합니다.
    - 데이터를 물리적으로 분산시키고, 네트워크를 통해 다른 노드나 메인 데이터베이스와 데이터를 주고받습니다.
    - 메인 데이터베이스는 분산된 데이터베이스를 통합적으로 관리합니다.
3. 통신 네트워크(with Network)
    - 모든 노드와 메인 데이터베이스를 연결하는 역활을 합니다.
    - 사용자 요청, 데이터 전송, 트랜잭션 수행 등 모든 통신이 이 네트워크를 통해 이루어집니다.
    - 네트워크가 안정적으로 작동해야 시스템 전체가 원활히 운영될 수 있습니다.

### 투명성

분산 데이터베이스 시스템의 투명성 개념은 사용자와 시스템 간의 상호작용을 단순화하고, 분산 환경의 복잡성을 감추기 위해 존재합니다.

1. 위치 투명성: 사용자는 데이터의 물리적 위치를 알 필요 없이 접근할 수 있습니다.
2. 중복 투명성: 데이터가 여러 곳에 중복되어 있어도 사용자는 단일 데이터처럼 사용할 수 있습니다.
3. 병행 투명성: 여러 트랜잭션이 동시에 실행되어도 결과의 일관성이 유지됩니다.
4. 장애 투명성: 시스템 구성 요소의 장애에도 불구하고 트랜잭션의 정확성이 보장됩니다.

> 투명성은 분산 데이터베이스 시스템이 복잡한 내부 구조를 숨기고, 사용자에게 단순하고 직관적인 데이터 접근 환경을 제공합니다. 
{: .prompt-info }

## CAP 이론이란?

CAP 이론은 일관성(Consistency), 가용성(Availability), 분할 허용성(Partition Tolerance)의 약자로 분산 시스템 설계에서 세 가지 속성을 동시에 만족할 수 없다는 원칙입니다. 이는 시스템의 요구사항과 특성에 맞춰 균형을 조절하는 것입니다. 

### CAP 이론의 세 가지 속성

📋일관성(Consistency)  
모든 노드가 같은 시점에 동일한 데이터를 제공해야 합니다. 예를 들어 통신사 고객센터에서 주소 변경 요청을 처리한 후 다른 상담원에게 재확인 시 변경 내용이 반드시 반영되어야 합니다.

📋가용성(Availability)  
시스템은 항상 응답 가능해야 합니다. 네트워크 일부가 단절되더라도 살아 있는 노드는 즉시 요청을 처리하며, 고객센터와 같은 곳이 24시간 운영되는 것이 대표적 예시입니다.

📋분할 허용성(Partition Tolerance)  
네트워크 분할(노드 간 통신 단절) 발생 시에도 시스템은 정상 작동해야 합니다. 클라우드 환경에서 지역별 서버 간 연결이 끊어져도 개별 서버는 독립적으로 서비스를 유지할 수 있어야 합니다.

### CAP 시스템 설계 시 트레이드오프

|선택 유형|특징|적용 사례|
|:--|:--|:--|
|CA|네트워크 분할 시 <br>서비스 중단|RDBMS<br>(MySQL, PostgreSQL)|
|CP|분할 시 일관성 우선,<br>가용성 희생|MongoDB, <br>Redis(분산락 사용 시)|
|AP|분할 시 가용성 우선,<br>일관성 희생|Cassandra, <br>DynamoDB|

> 분산시스템에서는 네트워크 분할이 불가피하므로, 실제 설계에서는 CP나 AP 중 하나를 선택해야 합니다.
{: .prompt-warning }

1. `CP` 선택 예시: 금융시스템은 계좌 잔액 정확성을 최우선으로 둔다.
2. `AP` 선택 예시: SNS 피드 서비스는 일시적 데이터 불일치를 허용합니다.

### CAP 이론의 적용 사례

분산 데이터베이스 시스템에서 CAP 이론은 일관성을 우선하는 `CP`와 일관성을 희생하고 가용성을 우선하는 `AP`가 있습니다. 

✅일관성 우선 시스템(CP)
- 데이터의 일관성을 보장하기 위해 가용성을 희생합니다.
- 최신 데이터를 확신할 수 없는 경우 쿼리에 오류를 반환하거나 응답을 지연시킵니다.

✅가용성 우선 시스템(AP)
- 시스템의 지속적인 운영을 위해 일관성을 희생합니다.
- 데이터가 최신이 아닐 수 있지만, 모든 쿼리에 응답합니다.

### 실세 시나리오

1. **전자상거래 플랫폼**: 재고 관리 시스템에서 일관성을 우선시하여 과잉 판매를 방지할 수 있습니다.
2. **소셜 미디어 플랫폼**: 가용성을 우선시하여 사용자 경험을 개선하고 지속적인 서비스를 제공할 수 있습니다.
3. **금융 시스템**: 트랜잭션이 정확성이 중요하므로 일관성을 우선시합니다.

### CAP 이론 구현 고려사항 

- **분산 합의 프로토콜**: Raft나 Paxos와 같은 프로토콜을 사용하여 일관성을 보장할 수 있습니다.
- **하이브리드 접근**: 일부 시스템은 상황에 따라 CP 또는 AP 모드로 전환할 수 있는 유연성을 제공합니다.
- **네트워크 팦티션 관리**: 네트워크 장애 상황에서의 동작을 명확히 정의하고 관리해야 합니다.

> CAP 이론의 적용은 시스템의 요구사항과 특성에 따라 달라집니다.
{: .prompt-info }


## 마치며

분산 데이터베이스 시스템과 CAP 이론은 현대의 대규모 데이터 처리와 고가용성 요구사항을 충족시키는 데 중요한 역할을 합니다. 분산 데이터베이스는 물리적으로 분산되어 있지만 논리적으로 통합된 시스템으로, 데이터의 효율적인 관리와 처리를 가능하게 합니다.

CAP 이론은 이러한 분산 시스템 설계에 있어 핵심적인 지침을 제공합니다. 일관성(Consistency), 가용성(Availability), 분할 허용성(Partition Tolerance) 중 동시에 두 가지만 충족할 수 있다는 원칙은 시스템 설계자들에게 중요한 트레이드오프를 고려하게 합니다.

실제 적용에 있어서는 시스템의 요구사항과 특성에 따라 CP(일관성과 분할 허용성) 또는 AP(가용성과 분할 허용성)를 선택하게 됩니다. 예를 들어, 금융 시스템에서는 데이터의 정확성이 중요하므로 CP를 선택할 수 있고, 소셜 미디어 플랫폼에서는 서비스의 지속적인 가용성이 중요하므로 AP를 선택할 수 있습니다.

분산 데이터베이스 시스템과 CAP 이론의 이해는 현대의 복잡한 데이터 환경에서 효율적이고 안정적인 시스템을 구축하는 데 필수적입니다. 이를 통해 대규모 데이터를 효과적으로 관리하고, 사용자에게 높은 성능과 안정성을 제공할 수 있습니다.
