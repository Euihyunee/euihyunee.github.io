---
title: "🌐HTTP의 동작방식과 HTTPS와의 차이"
date: 2025-01-08 08:49 +0900
categories: [cs]
tags: [http, https, ssl, ca]
---

> 전 글에서 HTTP의 개념과 HTTP의 진화과정에 대해 알아보았습니다. 이번 글에서는 HTTP가 웹에서 어떻게 동작하는지에 대해 설명하고, HTTPS는 무엇인지, HTTP와 차이가 무엇인지에 대해 알아보겠습니다. 

## 🌐HTTP의 동작방식

HTTP의 동작방식을 보면 다음 그림과 같습니다. 

![http_behavior.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/http_behavior.png?raw=true)

1. URL 검색: 사용자가 웹 브라우저의 주소창에 URL을 입력하고 엔터를 누릅니다.
2. 도메인 네임: 입력된 도메인 이름을 IP 주소로 변환하기 위해 DNS를 조회합니다.
3. IP 주소: DNS가 IP주소를 얻어옵니다. 
4. TCP 연결 수립:
    - 브라우저는 얻은 IP 주소를 사용하여 웹 서버와 TCP 연결을 시도합니다. 
    - 3-way handshake 과정을 통해 연결을 수립합니다. 
5. HTTP 요청 전송: TCP 연결이 수립되면, 브라우저는 HTTP 요청 메시지를 생성합니다.
6. HTTP 응답 전송: 웹 서버는 HTTP 요청을 받아 처리한 후 HTTP 응답 메시지를 생성하여 클라이언트에게 전송합니다. 
7. TCP 연결 종료: 
    - HTTP 응답이 완료되면, 서버와 클라이언트는 TCP 연결을 종료합니다.  
    - 4-way handshake 과정을 통해 연결을 종료합니다. 
8. HTTP 응답 데이터를 받은 브라우저는 HTTP 응답의 본문을 파싱하여, 웹 페이지를 렌더링하여 사용자에게 표시합니다. 

### TCP란? 

위의 HTTP 동작방식에서 TCP란 개념이 나온다. TCP(Transmission Control Protocol)는 신뢰성 있는 데이터를 위해 사용되는 프로토콜입니다. TCP 통신 과정은 크게 연결 수립, 데이터 전송, 연결 종료의 세 단계인로 나눌 수 있습니다. 각 과정에 대해 알아보겠습니다. 


#### 연결과정(3-way handshake)

![tcp_behavior.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/tcp_behavior.png?raw=true)

TCP의 연결과정은 간단히 말해, 두 컴퓨터가 안전하게 데이터를 주고 받기 위한 사전 작업입니다. 서로를 인식하고, 상태를 확인하고, 합의하에 통신하는 것입니다. 이러한 과정의 목적은 두 컴퓨터가 안전하고 효율적으로 데이터를 주고받을 수 있는 연결을 통해 원활하게 데이터를 교환하기 위함입니다. 과정별로 설명하자면 다음과 같습니다. 

1. 연결(SYN) 요청:
    - 클라이언트가 서버에 연결을 요청합니다.
    - SYN(Synchronize)라는 패킷을 보내며, 이는 TCP 연결을 시작하는 신호로 사용됩니다. 
2. 연결 승인(SYN-ACK):
    - 서버가 클라이언트의 연결 요청을 수락합니다.
    - ACK(Acknowledgment)라는 패킷을 SYN과 함께 보내며, 연결 요청을 승인하고 서버가 연결을 시작할 준비가 되었음을 알리는 역활을 합니다. 
3. 연결 확립(ACK):
    - 클라이언트가 서버의 응답(SYN-ACK)을 확인하고 연결을 확립(`Established` 상태)합니다. 
    - 서버도 클라이언트의 ACK를 받고 연결을 확립(`Established` 상태)합니다.

`3-way handshake`이 끝나고 나면 클라이언트와 서버가 연결이 수립되어 실제 데이터 전송이 시작됩니다. 

#### 연결종료과정(4-way handshake)

`3-way handshake`이 끝나고 데이터 전송을 마친 후에는 연결을 해제해야 합니다. TCP 연결 종료 과정은 `4-way handshake`라고 불리며, FIN(Finish)와 ACK(Acknowledgement)를 사용합니다. 과정별로 설명하자면 다음과 같습니다.

![4_way_handshake.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/4_way_handshake.png?raw=true)

1. 연결 종료 요청(FIN):
    - 클라이언트가 서버에 연결 종료를 요청합니다.
    - FIN은 클라이언트가 더 이상 전송할 데이터가 없음을 알리는 패킷입니다.
2. 종료 요청 확인(ACK):
    - 서버는 클라이언트(FIN) 종료 요청에 대해 ACK로 응답합니다.
    - ACK는 서버가 클라이언트의 연결 종료 요청을 받았음을 확인하는 패킷입니다.
3. 서버 측 연결 종료(FIN):
    - 서버가 남은 데이터를 모두 전송한 후 FIN 패킷을 클라이언트에게 전송합니다.
    - FIN은 서버가 더 이상 전송할 데이터가 없으며, 연결을 종료할 준비를 마쳤다는 것을 알립니다.
4. 종료 확인(ACK):
    - 클라이언트는 서버의 FIN에 대해 ACK로 응답합니다.
    - ACK는 클라이언트가 서버 연결 종료 요청을 받았음을 확인하고, ACK를 서버에 전송합니다. 
    - 클라이언트는 TIME_WAIT 상태로 들어갑니다. 대기 시간이 끝난 후에 클라이언트는 연결을 종료합니다.
    - 클라이언트가 보낸 ACK를 받은 서버는 연결을 종료합니다.

> `TIME_WAIT`은 지연된 패킷이 새로운 연결에 영향을 주는 것을 방지하기 위해 사용합니다. 또한 마지막 ACK가 손실된 경우 재전송할 수 있는 기회를 제공합니다. ACK가 서버에 도달하지 않는다면 서버는 연결 종료를 하지 않는 것을 방지하기 위해 사용합니다.

이렇게 HTTP는 웹 브라우저와 웹 서버 간의 신뢰성 있는 데이터 전송을 위해 TCP 프로토콜을 사용합니다. 또한 HTTP에서 성능을 향상시키는 방법은 TCP에서 비롯된 것들이 많습니다(지속 연결, TCP 최적화, 버퍼 관리 등). 따라서 웹 개발에서 반드시 알아야하는 개념이라고 생각합니다.


## 🌐HTTP의 주요 취약점 + HTTPS가 나온 이유

위에서 HTTP의 동작방식이 신뢰성있는 통신이라고 하였습니다. 그럼에도 불구하고 HTTPS가 나온 이유는 무엇일까요? 

<br>

#### HTTP의 취약점 

HTTP의 취약점은 주로 보안성에 있습니다. 

- 도청 가능성:
    - HTTP는 평문 통신을 사용하기 때문에 데이터가 암호화되지 않은 상태로 전송됩니다. 이로 인해 중간자가 네트워크를 통해 전송되는 데이터를 쉽게 가로채고 읽을 수 있습니다.
- 데이터 무결성 부족:
    - HTTP는 전송 중 데이터의 변조를 감지하거나 방지할 수 있는 메커니즘이 없습니다. 이는 중간자가 전송되는 데이터를 수정할 수 있습니다.
- 인증 부재:
    - HTTP는 통신 상대를 확인하지 않기 때문에 서버나 클라이언트의 신원을 보장할 수 없어 위장 공격에 취약합니다. 



## 🌐HTTPS의 보안성

이러한 HTTP의 문제점을 해결하기 위해 HTTPS가 개발되었습니다. HTTPS에는 SSL 인증서를 사용하여 웹 통신 보안성을 크게 향상되었으며, 현재 대부분의 웹사이트에서 표준으로 사용되고 있습니다.

HTTPS는 HTTP에 보안 계층을 추가한 프로토콜로, SSL/TLS를 사용하여 데이터를 암호화하여 전송하기 때문에 중간에 데이터가 탈취되거나 수정하기 어렵습니다. HTTPS는 보안성에서 뛰어난 특징을 가집니다.

- 데이터 암호화: HTTPS는 SSL/TLS를 사용하여 모든 통신을 암호화합니다.
- 데이터 무결성 보장: HTTPS는 암호화 해시를 사용하여 전송 중 데이터 변조를 감지합니다.
- 인증: SSL/TLS 인증서를 통해 서버의 신원을 확인합니다.

> HTTPS는 보안성 외에도 HTTP/2.0 버전 이상에서 성능이 개선됩니다. 

## 🌐HTTPS의 동작방식 

![ssl_handshake.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/ssl_handshake.png?raw=true)

기본적으로 HTTP 통신의 동작방식에서 TCP의 3-way handshake 연결 수립이 이루어진 직후에 SSL/TLS handshake 동작이 추가된 형태입니다. SSL/TLS handshake 동안 클라이언트와 서버는 암호화 정보를 교환하여 공유 비밀 키를 생성하여 후속 통신을 암호화합니다. 


1. CilientHello
    - 클라이언트가 서버에 보내는 첫 번째 메시지입니다.
    - 지원하는 SSL/TLS 버전, 암호화 알고리즘 목록, 클라이언트 랜덤 데이터를 넣어 보냅니다.
2. ServerHello
    - 서버가 클라이언트의 제안에 응답하는 메시지입니다.
    - 선택된 SSL/TLS 버전, 선택한 암호화 알고리즘, 서버 랜덤 데이터를 넣어 보냅니다. 
3. SeverCertificate
    - 서버의 SSL/TLS 인증서를 클라이언트에게 전송합니다.
    - 서버의 공개키와 인증 기관(CA) 서명을 넣어 보냅니다.
4. ServerHelloDone
    - 서버가 초기 협상 단계를 마쳤음을 클라이언트에게 알리는 메지지입니다.
5. ClientKeyExchang
    - 클라이언트가 생성한 `Pre-master Secret`을 서버의 공개키로 암호화하여 전송합니다. 
    - 프리마스터 시크릿은 실제 데이터를 암호화하는데 사용하는 세션 키를 생성하고 보안 연결을 수립하는 데 핵심적인 역활을 합니다. 이 단계에서는 클라이언트가 랜덤 데이터를 생성하여 프리마스터 시크릿을 만든 후, ❸단계에서 받은 서버의 공개키로 프리마스터 시크릿을 암호화하여 서버로 전송합니다.
6. ChangeCipherSpec
    - 이 메시지는 협상된 암호화 방식으로 암호화됨을 알리는 메시지입니다.
7. Finished
    - `handshake`의 마지막 메시지로, 이전 교환 내용의 해시를 포함하고, 상대방이 올바르게 메시지를 수신했는지 확인합니다.

이 과정을 통해 클라이언트와 서버는 안전한 암호화 통신을 위한 공유 비밀키를 설정하고, 서로의 신원을 확인합니다. 이후의 모든 데이터 교환은 이 과정에서 설정된 세션키를 사용하여 암호화됩니다. 


## 마치며 

이번 글에서는 HTTP의 동작방식과 HTTPS와의 차이점에 대해 자세히 알아보았습니다. HTTP는 웹의 기본적인 통신 프로토콜로, 클라이언트와 서버 간의 데이터 교환을 가능하게 합니다. 그러나 HTTP의 보안 취약점으로 인해 HTTPS가 개발되었고, 현재 웹 통신의 표준으로 자리 잡았습니다.
HTTPS는 SSL/TLS를 통해 데이터를 암호화하고, 무결성을 보장하며, 서버의 신원을 확인합니다. 이를 통해 HTTP의 주요 취약점인 도청, 데이터 변조, 위장 공격 등을 효과적으로 방지할 수 있습니다.


웹 개발자로서 HTTP와 HTTPS의 동작 방식을 이해하는 것은 매우 중요합니다. 이는 안전하고 효율적인 웹 애플리케이션을 개발하는 데 필수적인 지식이기 때문입니다. 또한, TCP의 연결 수립과 종료 과정, SSL/TLS 핸드셰이크 과정 등의 세부적인 메커니즘을 이해하면 네트워크 통신의 최적화와 문제 해결에 큰 도움이 될 것입니다.


앞으로도 웹 기술은 계속 발전할 것이며, 보안과 성능 측면에서 더욱 향상될 것입니다. 따라서 웹 개발자들은 이러한 기본적인 프로토콜의 동작 원리를 숙지하고, 새로운 기술 동향을 지속적으로 파악하는 것이 중요합니다. 이를 통해 더 안전하고 효율적인 웹 서비스를 제공할 수 있을 것입니다.