---
title: "💬멀티 프로세스와 멀티 스레드에 대해서"
date: 2025-01-16 10:05 +0900
categories: [CS]
tags: [process, thread]
---

> [저번글](https://euihyunee.github.io/posts/process_thread/)에서는 프로세스와 스레드의 개념과 동작 방식 등에 대해 알아보았습니다. 아직 안 읽고 오셨다면 읽고 오시는 걸 추천드립니다. 이번 글에서는 멀티 프로세스와 멀티 스레드 방식의 개념과 시스템 자원을 어떻게 사용하는지, 차이점은 무엇인지, 각 상황에서 어떤 방식을 사용하는지 알아보겠습니다.

**하나의 CPU는 한번에 하나의 프로세스를 실행할 수 있습니다.** 하지만 현대 컴퓨터는 여러 프로세스를 잘게 쪼개어 번갈아가며 실행하여 여러 프로세스를 동시에 실행하는 것처럼 보이게 만듭니다. **프로세스 내에는 다시 여러 개의 스레드가 있습니다.** 여러 스레드는 여러 작업을 병렬로 처리하여 전반적인 성능을 개선합니다. 예를 들어 CPU가 크롬을 실행하면 메인 프로세서, 렌더링을 담당하는 렌더러 프로세스, GPU 프로세스, 플러그인 프로세스를 생성하여 작업을 분리합니다. 크롬에서 여러 탭을 열면 각 탭마다 별도의 렌더러 프로세스가 생성되며 그 안에는 렌더링을 담당하는 렌더링 스레드, IPC 관리를 담당하는 I/O 스레드, 입력 이벤트 등을 처리하는 컴포지터 스레드 등의 스레드가 생성되어 성능 향상, 응답성 개선, 그리고 효율적인 자원 공유를 가능하게 합니다.

![multi_process_thread.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/multi_process_thread.png?raw=true)

## 멀티 프로세스(Multi Process)

멀티 프로세스는 말 그대로 하나의 CPU에 여러 개의 프로세스를 동시에 실행하는 것을 뜻합니다. 정확히는 하나의 컴퓨터 시스템에 여러 개의 중앙처리장치(CPU)를 장착하여 동시에 여러 작업을 처리하는 방식입니다. 이는 [이전글](https://euihyunee.github.io/posts/process_thread/)에서 설명한 동시성, 병렬성, 컨텍스트 스위칭, 스케줄링 등의 기술을 사용하여 효율적인 병렬 처리와 시스템 자원의 최적화된 사용을 가능하게 합니다. 그리고 한 프로세스 내의 여러 스레드들이 자원 공유를 하는 것처럼 프로세스 간에도 자원 공유를 하는 기술인 **IPC(Inter Process Communication)**가 있습니다. 이는 운영체제가 각 프로세스에 독립적인 메모리 공간을 할당하고 관리하는 기술과 함께 사용되어 프로세스 간의 독립성을 유지하면서도 필요한 정보를 교환할 수 있습니다.

## 프로세스의 자원 공유

프로세드 또한 스레드처럼 자원 공유를 할 수 있습니다. 프로세스의 자원 공유는 멀티 프로세스 환경에서 여러 프로세스가 데이터와 자원을 공유하는 메커니즘을 말합니다. 기본적으로 프로세스는 독립적인 메모리 공간을 가지고 있어 직접적인 자원 공유가 불가능하지만, 운영체체에서 프로세스 간 통신(IPC, Inter-Process Communication)을 통해 자원 공유를 가능하게 합니다.

> 이외에도 원격 프로시저 호출(RPC, Remote Procedure Call), 원격 메소드 호출(RMI, Remote Method Invocation), IPC의 한 형태인 LPC(Local Procedure Call)등이 있습니다.

![ex_ipc.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/ex_ipc.png?raw=true)

프로세스의 자원 공유는 특정 상황에서만 사용됩니다. 이는 복잡성, 보안 위험, 그리고 성능 저하 등의 문제로 인해 제한적으로 적용됩니다. 또한, 프로세스 간 전환 시 캐시 메모리의 초기화가 필요하여 상당한 자원 부담이 발생합니다. 이러한 이유로 멀티 스레드를 기본적으로 사용합니다.

## 멀티 프로세스의 목적

주요 목적은 다음과 같습니다.

📋 먼저, 병렬 처리입니다. 하드웨어적인 한계로 CPU 개수에 한계가 있어 동시에 실행할 수 있는 프로세스 수가 한정적입니다. 그래서 여러 CPU 코어를 효과적으로 활용하여 동시에 여러 작업을 처리하여, 복잡한 계산이나 대규모 데이터 처리 작업의 성능을 크게 향상시킵니다. 

📋 두 번째로, 시스템 안정성을 극대화하기 위함입니다. 프로세스 간 메모리의 격리로 여러 프로세스를 사용하는 환경에서 한 프로세스의 오류가 다른 프로세스에 영향을 미치지 않도록 합니다. 이는 전체 시스템에 대한 안정성을 올려줍니다. 중요한 서비스나 애플리케이션의 안정적인 운영을 보장하기 위해 사용합니다. 각 프로세스가 독립된 메모리 공간을 사용하기에 데이터 보안 또한 강화하여 외부로부터 시스템을 보호하는 목적도 있습니다.

📋 세 번째로, 확장성을 가지기 위함입니다. 각 프로세스는 독립된 메모리 공간과 시스템 자원을 할당받습니다. 이로 인해 새로운 프로세스를 추가하거나 제거해도 기존 프로세스에 영향을 미치지 않습니다. 그리고 각 프로세스에 필요한 만큼의 자원을 동적으로 할당할 수 있기에 시스템 리소스가 허용하는 한 새로운 프로세스를 계속 추가할 수 있습니다. 마지막으로 크롬의 예시처럼 시스템의 각 기능을 별도의 프로세스로 구현할 수도 있습니다. 따라서 새로운 기능이 필요할 때 기존 시스템을 수정하지 않고 새 프로세스를 추가할 수 있습니다.

> 이러한 목적들을 통해 멀티 프로세스는 시스템에서 성능, 안정성, 보안, 그리고 확장성을 제공하는 중요한 역활을 합니다.


## 멀티 스레드(Multi Tread)

멀티 스레드는 **하나의 프로세스 내에서 여러 개의 실행 흐름(스레드)을 동시에 처리**하는 방식입니다. [이전글](https://euihyunee.github.io/posts/process_thread/)에서 설명했듯이 멀티 스레드는 프로세스 내의 자원 공유, 스케줄링, 컨텍스트 스위칭을 사용해 동작합니다. 하지만 멀티 스레드는 기본적으로 자원을 공유하기 때문에 공유 자원에 대한 데이터 일관성과 동시에 접근하는 것을 막고, 순서를 보장하기 위해 동기화 메커니즘을 사용합니다.

## 멀티 스레드의 동기화 메커니즘

유명한 식사하는 철학자 문제를 통해 멀티 스레드의 동기화 메커니즘을 설명하겠습니다. 이 문제는 동시성 프로그래밍의 고전적인 예시로, 다양한 동기화 기법을 적용할 수 있습니다.

**🆀 식사하는 철학자 문제**

![philosophers_meal_problem.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/philosophers_meal_problem.png?raw=true)

- 5명의 철학자가 원형 테이블에 앉아 있습니다.
- 각 철학자 사이에 포크가 하나씩 있습니다.(정면 포크가 오른쪽입니다.)
- 철학자는 생각하거나 식사를 합니다.
- 식사를 하려면 양옆의 두 개의 포크가 모두 필요합니다.

1. 오른쪽 포크가 사용 가능해질 때까지 대기한다. 만약 사용 가능하다면 집어든다.
2. 왼쪽 포크가 사용 가능해질 때까지 대기한다. 만약 사용 가능하다면 집어든다.
3. 양쪽의 포크를 잡으면 일정 시간만큼 식사를 한다.
4. 오른쪽 포크를 내려놓는다. 
5. 왼쪽 포크를 내려놓는다.

먼저, 동기화 메커니즘 없는 경우를 보겠습니다.

![circular_standby.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/circular_standby.png?raw=true)

- 각 철학자가 자신의 왼쪽 포크를 집고 오른쪽 포크를 기다리는 상황입니다.
- 철학자들은 자신의 왼쪽 포크를 점유한 채 오른쪽 포크를 기다리므로, 순환 대기 상태가 발생하며, 데드락이 형성됩니다.
- 화살표는 철학자가 포크를 요청하거나 점유하려는 관계를 나타냅니다.

여기서는 모두가 오른쪽 포크를 얻으려고 하기에 5명의 철학자 전부 오른쪽 포크를 들고 있다면 왼쪽 포크는 이미 상대방이 가져간 상태이다. 이렇게 원탁을 한 바퀴 돌아 자기 자신까지 돌아오면 모든 철학자들기 2번 상태에 머무르며 왼쪽 포크를 계속 사용하려고 대기하는 교착(Deadlock) 상태에 빠지게 된다.

```text
철학자1 -> 포크1 -> 철학자2 -> 포크2 -> 철학자3 
철학자3 -> 포크3 -> 철학자4 -> 포크4 -> 철학자5
철학자5 -> 포크5 -> 철학자1 (순환 대기)
```

다음으로 동기화 메커니즘 예시 그림입니다.

![syn_fork.png](https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/syn_fork.png?raw=true)

홀수 번호 철학자

1. 왼쪽 포크를 먼저 집습니다.
2. 오른쪽 포크를 그 다음에 집습니다.
3. 식사를 합니다.
4. 두 포크를 모두 내려놓습니다.

짝수 번호 철학자

1. 오른쪽 포크를 먼저 집습니다.
2. 왼쪽 포크를 그 다음에 집습니다.
3. 식사를 합니다.
4. 두 포크를 모두 내려놓습니다. 

이처럼 홀수 번호 철학자와 짝수 번호 철학자가 서로 다른 순서로 포크를 집음으로써 데드락을 방지할 수 있습니다. 동기화 메커니즘에서는 스레드의 공유 자원 접근을 제어하여 데이터 무결성을 보장하고 접근 순서를 제어하는 등 공유 자원을 안전하고 효율적으로 사용하는 핵심적인 역활을 수행합니다.

> 위의 예시는 완벽한 동기화 메커니즘이 아닌 이해를 돕기 위한 예시입니다. 홀짝으로 구분하는 방법은 교착 상태의 4가지 필요조건 중 `환영대기`를 해결하지만 `기아 현상`이 발생합니다. 실제 동기화 메커니즘은 더욱 복잡하게 이루어져 있습니다.

## 멀티 스레드의 목적

주요 목적은 다음과 같습니다. 

📋 먼저, 멀티 스레드를 사용하면 프로그램의 전반적인 성능을 향상시킬 수 있습니다. 프로세서 안에 여러 개의 스레드를 동시에 실행할 수 있어 병렬성이 증가해 전체적인 처리 속도가 향상됩니다. 이는 I/O 작업 중 발생하는 대기 시간을 다른 스레드의 실행으로 채워 CPU 사용률을 높일 수 있습니다.

📋 두 번째로, 프로세스 안에 있는 여러 스레드들은 해당 프로세스의 데이터와 힙 영역을 공유하는 메모리 공유를 합니다. 이를 통해 메모리 사용을 최소화하며, 스레드 생성 및 컨텍스트 스위칭이 프로세스에 비해 적은 비용으로 수행됩니다.

📋 세 번째로, 하나의 스레드가 막힘(블록)이 있어도 다른 스레드가 계속 실행되기에 프로그램의 응답성이 향상됩니다. 이는 사용자가 느끼기에 프로그램에서 내부 동작에서 한 스레드가 막히더라도 사용자에게는 느끼지 못하도록 합니다. 

## 멀티 프로세스와 멀티 스레드의 차이점

위의 내용들을 종합하여 멀티 프로세스와 멀티 스레드의 차이를 보면 다음과 같습니다.

1. 자원 공유
    - 멀티 프로세스: 프로세스 간 자원을 공유하지 않음
    - 멀티 스레드: 같은 프로세스 내의 자원을 공유함
2. 안정성
    - 멀티 프로세스: 한 프로세스의 문제가 다른 프로세스에 영향을 주지 않음
    - 멀티 스레드: 한 스레드의 문제가 전체 프로세스에 영향을 줄 수 있음
3. 효율성
    - 멀티 프로세스: 프로세스 생성과 컨텍스트 스위칭 비용이 큼
    - 멀티 스레드: 스레드 생성과 전환 비용이 상대적으로 작음
4. 통신
    - 멀티 프로세스: 프로세스 간 통신(IPC)이 필요하며 비용이 큼 
    - 멀티 스레드: 스레드 간 통신이 간단하고 비용이 적음

멀티 프로세스와 멀티 스레드는 각각의 장단점이 있으며, 적용 상황에 따라 적절히 선택하여 사용해야 합니다. 현대의 많은 시스템에서는 두 방식을 결합하여 사용함으로써 성능과 효율성을 최적화하고 있습니다. 

예시로, 서버 시스템과 같이 안정성을 가져야 한다면 한 서버에 문제가 발생해도 다른 서버는 정상적으로 작동하도록 멀티 프로세스 방식이 유리합니다. 또한 대규모 작업이 필요한 경우 작업을 분산시킨 멀티 프로세스 방식을 채택하여 성능을 향상시킬 수 있습니다. 

반대로 멀티 스레드는 웹서버에서 동시에 여러 클라이언트의 요청을 처리하는 경우 각 요청을 별도의 스레드에서 처리하여 처리 속도를 높이는 것이 유리합니다. 또한 데이터를 빠르게 처리해야 하는 실시간 데이터의 처리에 멀티 스레드를 사용합니다.

## 마치며 

멀티 프로세스와 멀티 스레드는 각각의 장단점을 가지고 있으며, 시스템의 요구사항에 따라 적절히 선택되어야 합니다. 많은 현대 시스템에서는 두 방식을 혼합하여 사용함으로써 안정성과 효율성을 모두 확보하고 있습니다. 

개발자는 애플리케이션의 특성, 성능 요구사항, 그리고 시스템 자원을 고려하여 적절한 병렬 처리 방식을 선택해야 합니다. 멀티 프로세스와 멀티 스레드의 효과적인 활용은 현대 소프트웨어 개발에서 중요한 요소입니다. 이를 통해 시스템의 성능을 최적화하고, 사용자 경험을 향상시키며, 복잡한 작업을 효율적으로 처리할 수 있습니다. 따라서 각 방식의 특성을 깊이 이해하고, 적절히 적용하는 것이 성공적인 시스템 설계의 핵심이라고 할 수 있습니다.