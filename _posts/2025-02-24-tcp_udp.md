---
title: "💬 TCP와 UDP의 개념 feat. 흐름제어&혼잡제어"
date: 2025-02-24 10:43 +0900
categories: [CS]
tags: [Network, TCP, UDP, Flow Control, Congestion Control]
---

> TCP(Transmission Control Protocol)와 UDP(User Datagram Protocol)는 전송 계층에서 사용되는 주요 프로토콜입니다. 애플리케이션 계층과 네트워크 계층 사이에서 데이터 전송을 담당합니다. 이 글에서 TCP/UDP의 개념과 각각의 역활, 흐름 제어, 혼잡 제어 그리고 어떤 부분에서 활용되는지 알아보겠습니다.

## TCP란?

위의 HTTP 동작방식에서 TCP란 개념이 나온다. TCP(Transmission Control Protocol)는 신뢰성 있는 데이터를 위해 사용되는 프로토콜입니다. TCP 통신 과정은 크게 연결 수립, 데이터 전송, 연결 종료의 세 단계인로 나눌 수 있습니다. 각 과정에 대해 알아보겠습니다. 

### TCP 연결과정(3-way handshake)

TCP의 연결과정은 간단히 말해, 두 컴퓨터가 안전하게 데이터를 주고 받기 위한 사전 작업입니다. 서로를 인식하고, 상태를 확인하고, 합의하에 통신하는 것입니다. 이러한 과정의 목적은 두 컴퓨터가 안전하고 효율적으로 데이터를 주고받을 수 있는 연결을 통해 원활하게 데이터를 교환하기 위함입니다. 과정별로 설명하자면 다음과 같습니다. 

<style>
  .img_container_box {
    display: flex;
    flex-wrap: wrap;
  }
  .left-div-example, .right-div-example {
    flex: 1;
    min-width: 300px; /* 최소 너비 설정 */
  }
  .left-div-example img {
    width: 100%;
    height: auto;
    padding-right: 10px;
  }
  .right-div-example {
    padding-top: 10px;
  }
  @media (max-width: 768px) {
    .right-div-example {
      flex-basis: 100%;
      order: 2;
    }
  }
</style>

<div class="img_container_box">

  <div class="left-div-example">
    <img src="https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/tcp_behavior.png?raw=true" alt="tcp_behavior">
  </div>

  <div markdown="1" class="right-div-example">


1️⃣ **연결(SYN) 요청:**

- 클라이언트가 서버에 연결을 요청합니다.
- SYN(Synchronize)라는 패킷을 보내며, 이는 TCP 연결을 시작하는 신호로 사용됩니다.

2️⃣ **연결 승인(SYN-ACK):**

- 서버가 클라이언트의 연결 요청을 수락합니다.
- ACK(Acknowledgment)라는 패킷을 SYN과 함께 보내며, 연결 요청을 승인하고 서버가 연결을 시작할 준비가 되었음을 알리는 역할을 합니다.



</div>
</div>


3️⃣ 연결 확립(ACK):
- 클라이언트가 서버의 응답(SYN-ACK)을 확인하고 연결을 확립(`Established` 상태)합니다. 
- 서버도 클라이언트의 ACK를 받고 연결을 확립(`Established` 상태)합니다.

> `3-way handshake`이 끝나고 나면 클라이언트와 서버가 연결이 수립되어 실제 데이터 전송이 시작됩니다. 
{: .prompt-info }


### TCP 연결종료과정(4-way handshake)

`3-way handshake`이 끝나고 데이터 전송을 마친 후에는 연결을 해제해야 합니다. TCP 연결 종료 과정은 `4-way handshake`라고 불리며, FIN(Finish)와 ACK(Acknowledgement)를 사용합니다. 과정별로 설명하자면 다음과 같습니다.

<div class="img_container_box">
  <div class="left-div-example">
    <img src="https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/4_way_handshake.png?raw=true" alt="4_way_handshake">
  </div>
  <div markdown="1" class="right-div-example">

1️⃣ 연결 종료 요청(FIN):

- 클라이언트가 서버에 연결 종료를 요청합니다.
- FIN은 클라이언트가 더 이상 전송할 데이터가 없음을 알리는 패킷입니다.

2️⃣ 종료 요청 확인(ACK):

- 서버는 클라이언트(FIN) 종료 요청에 대해 ACK로 응답합니다.
- ACK는 서버가 클라이언트의 연결 종료 요청을 받았음을 확인하는 패킷입니다.

3️⃣ 서버 측 연결 종료(FIN):

- 서버가 남은 데이터를 모두 전송한 후 FIN 패킷을 클라이언트에게 전송합니다.
- FIN은 서버가 더 이상 전송할 데이터가 없으며, 연결을 종료할 준비를 마쳤다는 것을 알립니다.


</div>
</div>

4️⃣ 종료 확인(ACK):

- 클라이언트는 서버의 FIN에 대해 ACK로 응답합니다.
- ACK는 클라이언트가 서버 연결 종료 요청을 받았음을 확인하고, ACK를 서버에 전송합니다. 
- 클라이언트는 TIME_WAIT 상태로 들어갑니다. 대기 시간이 끝난 후에 클라이언트는 연결을 종료합니다.
- 클라이언트가 보낸 ACK를 받은 서버는 연결을 종료합니다.

> `TIME_WAIT`은 지연된 패킷이 새로운 연결에 영향을 주는 것을 방지하기 위해 사용합니다. 또한 마지막 ACK가 손실된 경우 재전송할 수 있는 기회를 제공합니다. ACK가 서버에 도달하지 않는다면 서버는 연결 종료를 하지 않는 것을 방지하기 위해 사용합니다.

이렇게 HTTP는 웹 브라우저와 웹 서버 간의 신뢰성 있는 데이터 전송을 위해 TCP 프로토콜을 사용합니다. 또한 HTTP에서 성능을 향상시키는 방법은 TCP에서 비롯된 것들이 많습니다(지속 연결, TCP 최적화, 버퍼 관리 등). 따라서 웹 개발에서 반드시 알아야하는 개념이라고 생각합니다.

### TCP 역활

이러한 TCP는 인터넷에서 데이터를 안정적으로 전송하기 위한 과정을 거칩니다. 다음과 같은 중요한 역활을 수행합니다.
    
#### 데이터 전송의 신뢰성 보장 

- 연결 지향적 통신: 데이터 전송 전 3-way handshaking을 통해 연결을 설정하고, 4-way handshaking으로 연결을 종료합니다.
- 오류 검출 및 재전송: 데이터 손실, 중복, 오류 발생 시 재전송을 수행하여 신뢰성을 확보합니다.
- 순서 보장: 데이터가 송신된 순서대로 수신되도록 보장합니다.

#### 네트워크 관리

- 흐름 제어: 수신자의 처리 속도에 맞춰 데이터 전송 속도를 조절하여 버퍼 오버플로우를 방지합니다.
- 혼잡 제어: 네트워크의 혼잡도를 감지하고 데이터 전송 속도를 조절하여 효율적인 통신을 유지합니다.

#### 데이터 처리 

- 세그먼트화: 대용량 데이터를 적절한 크기의 세그먼트로 분할하여 전송합니다.
- 재조립: 수신된 세그먼트를 원래의 데이터 스트림으로 재구성합니다.

#### 주소 지정 및 다중화

- 포트 번호 사용: 여러 애플리케이션의 데이터를 구분하고 적절히 전달합니다.


## TCP 흐름제어

TCP 흐름제어는 송신 측과 수신 측 사이의 데이터 전송 속도를 조절하는 메커니즘입니다. 주요 목적은 수신 측의 처리 능력을 초과하는 데이터 전송을 방지하기 위함입니다. UDP에는 흐름 제어 기능이 없으며 TCP에만 있는 기능입니다.

- 수신 측이 송신 측에게 자신의 상태를 지속적으로 알립니다.
- 수신 버퍼의 오버플로우를 방지합니다.
- 전송 계층과 데이터 링크 계층에서 처리됩니다.

### Stop and Wait 흐름제어 방식

Stop and Wait 방식은 TCP 흐름제어의 가장 기본적인 형태로, 다음과 같은 특징을 가집니다.




<div class="img_container_box">

  <div class="left-div-example">
    <img src="https://github.com/Euihyunee/euihyunee.github.io/blob/main/_posts/img/stop_and_wait.png?raw=true" alt="stop_and_wait">
  </div>

  <div markdown="1" class="right-div-example">

***동작 원리***

- 송신자가 하나의 패킷을 전송한 후 수신자의 확인 응답(ACK)을 기다립니다.
- 수신자는 패킷을 성공적으로 받으면 ACK를, 오류가 있으면 NAK(Negatice ACK)를 보냅니다.
- 송신자는 ACK를 받은 후에만 다음 패킷을 전송합니다.

이처럼 Stop and Wait 방식은 구현이 간단하고 이해하기 쉬우며 순차적 처리로 패킷 순서 문제가 발생하지 않습니다.  
하지만, 네트워크 자원 활용도가 낮고 효율성이 떨어지는 단점이 있습니다. 또한, 매 패킷마다 ACK를 기다려야 하므로 전송 지연이 발생합니다.

</div>
</div>


> NAK는 수신자가 데이터를 제대로 받지 못했거나 오류가 있음을 송신자에게 알리는 신호입니다. 주로 패킷 손실, 데이터 손상, 또는 기타 오류 상황에서 사용됩니다.
{: .prompt-info }

Stop and Wait 방식은 간단하지만 비효율적이어서, 대역폭이 큰 네트워크에서는 성능이 크게 저하될 수 있습니다. 이러한 단점을 보완하기 위해 `Sliding Window`와 같은 더 효율적인 흐름제어 기법이 개발되었습니다.

### Sliding Window 흐름 제어 방식

## UDP란

### UDP 동작방식

### UDP 역활

